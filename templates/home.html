<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>Homepage</title>
    <link rel="stylesheet" href="{% static 'css/common.css' %}">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
</head>
<body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% if room_name == 0 %}
    <script>
        const socket = new WebSocket('ws://' + window.location.host + '/ws/chat');
    </script>
{% endif %}

<div class="logo">
    <svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="200.000000pt" height="124.000000pt"
         viewBox="0 0 735.000000 224.000000" preserveAspectRatio="xMidYMid meet">
        <g transform="translate(0.000000,224.000000) scale(0.100000,-0.100000)" fill="#87314e" stroke="none">
            <path d="M4280 1350 l0 -290 64 0 63 0 5 108 c3 59 9 115 13 125 9 20 46 32 78 23 36 -9 47 -47 47 -156 l0 -100 66 0 66 0 -4 134 c-3 132 -3 135 -34 172 -53 66 -77 78 -160 82 l-74 4 0 94 0 94 -65 0 -65 0 0 -290z"/>
            <path d="M6460 1350 l0 -290 65 0 65 0 0 290 0 290 -65 0 -65 0 0 -290z"/>
            <path d="M6658 1448 c-2 -106 -2 -237 0 -290 l3 -98 65 0 64 0 0 35 c0 19 3 35 6 35 3 0 24 -16 47 -35 39 -33 44 -35 117 -35 42 0 79 3 83 6 3 4 -44 47 -104 96 -91 74 -108 93 -97 103 7 7 57 49 110 93 54 44 94 82 91 86 -3 3 -38 6 -77 6 -68 0 -73 -2 -121 -40 l-50 -39 -3 134 -3 135 -64 0 -64 0 -3 -192z"/>
            <path d="M3679 1616 c-13 -6 -30 -23 -38 -37 -12 -22 -12 -29 0 -54 40 -84 165 -32 129 54 -15 37 -57 54 -91 37z"/>
            <path d="M782 1608 c-44 -7 -65 -15 -69 -26 -8 -22 -23 -32 -48 -32 -11 0 -40 -17 -64 -38 -41 -35 -43 -40 -34 -67 8 -26 5 -37 -24 -82 -31 -48 -33 -58 -33 -136 0 -96 -4 -89 117 -224 62 -68 82 -84 126 -99 65 -21 77 -30 77 -60 0 -16 -10 -28 -30 -39 -37 -19 -37 -36 -2 -135 26 -73 28 -75 62 -78 35 -3 36 -4 60 -80 25 -77 39 -92 69 -73 12 8 11 22 -9 95 -13 48 -21 88 -19 89 5 4 239 93 264 101 19 5 25 -6 61 -112 32 -92 44 -117 58 -117 40 0 41 28 3 141 -36 109 -36 134 -1 134 7 0 21 11 30 25 10 15 26 25 39 25 24 0 75 51 75 74 0 6 16 18 35 25 37 13 43 27 22 55 -11 15 -17 16 -40 5 -23 -10 -30 -10 -45 4 -28 26 -75 31 -109 13 -17 -8 -39 -14 -49 -14 -10 1 -29 -2 -42 -6 -19 -6 -25 -2 -37 28 -22 51 -19 68 20 146 19 38 35 76 35 84 0 8 -17 49 -37 92 -22 46 -36 90 -35 108 3 41 -46 101 -89 110 -17 3 -40 18 -52 32 -19 25 -24 26 -83 20 -50 -5 -63 -3 -68 9 -6 17 -37 18 -134 3z m76 -115 c3 -50 2 -53 -20 -53 -35 0 -48 13 -55 54 -7 43 6 58 47 54 23 -3 25 -8 28 -55z m145 25 c-2 -5 -3 -61 -3 -127 0 -110 -1 -119 -20 -124 -11 -3 -23 0 -26 5 -8 12 -22 239 -16 251 5 10 68 5 65 -5z m-288 -49 c8 -25 -8 -39 -47 -39 -32 0 -36 15 -11 42 22 24 50 23 58 -3z m403 5 c25 -17 27 -32 11 -104 -8 -39 -15 -50 -30 -50 -17 0 -19 8 -19 85 0 47 3 85 8 85 4 0 18 -7 30 -16z m-324 -90 c10 -4 16 -18 16 -38 0 -29 -6 -36 -51 -60 -39 -22 -49 -33 -47 -49 2 -17 12 -23 44 -27 48 -7 87 -30 109 -64 33 -50 77 -39 72 17 -2 30 -1 31 56 41 37 7 62 17 68 29 7 12 22 17 54 17 33 0 47 5 59 21 14 21 14 21 29 -7 13 -25 12 -32 -25 -111 l-39 -85 17 -59 c10 -35 13 -63 8 -68 -13 -11 -255 -103 -260 -98 -2 2 -10 21 -17 43 -13 35 -20 41 -83 65 -55 21 -79 37 -123 85 -97 107 -111 130 -111 193 0 87 19 110 115 137 95 26 89 26 109 18z m76 -128 c0 -11 -19 -15 -25 -6 -3 5 1 10 9 10 9 0 16 -2 16 -4z m555 -334 c9 -23 -21 -49 -42 -36 -24 15 -26 29 -8 47 18 18 40 13 50 -11z"/>
            <path d="M2287 1601 c-15 -11 -44 -16 -87 -16 -58 0 -66 -2 -75 -22 -7 -16 -18 -23 -38 -23 -38 0 -97 -63 -97 -105 0 -17 -16 -66 -35 -110 -19 -44 -35 -86 -35 -93 0 -8 16 -50 35 -95 35 -81 35 -81 19 -124 -16 -41 -17 -42 -58 -39 -23 2 -57 11 -75 21 -37 18 -74 14 -104 -13 -15 -13 -23 -14 -49 -4 -27 10 -33 9 -44 -6 -20 -25 -17 -31 21 -53 19 -12 35 -25 35 -29 0 -22 54 -70 86 -76 19 -3 34 -12 34 -20 0 -8 16 -22 35 -31 24 -11 34 -22 30 -31 -3 -8 -17 -56 -32 -106 -14 -50 -28 -96 -30 -102 -6 -16 25 -44 42 -38 8 3 30 57 51 121 42 132 25 126 178 67 144 -55 146 -56 146 -63 0 -3 -9 -39 -19 -80 -21 -77 -19 -96 6 -106 23 -8 29 1 55 85 24 74 24 75 55 72 36 -4 40 1 78 106 14 39 23 76 20 84 -3 8 -21 20 -41 27 -29 11 -34 16 -28 34 10 33 19 40 84 62 54 18 66 29 149 125 l91 105 0 89 c0 84 -2 92 -32 140 -23 35 -33 63 -33 90 0 35 -5 44 -43 73 -24 18 -54 33 -68 33 -14 0 -24 6 -24 14 0 18 -40 33 -118 44 -51 7 -66 6 -85 -7z m106 -60 c23 -9 24 -13 17 -51 -9 -47 -7 -45 -42 -54 l-28 -6 0 60 c0 64 5 69 53 51z m-134 -95 c-1 -39 -4 -96 -7 -126 -6 -46 -11 -56 -28 -58 -18 -3 -22 4 -27 35 -8 45 -9 218 -2 225 3 2 18 3 35 0 l30 -4 -1 -72z m280 20 c28 -30 19 -50 -18 -41 -35 9 -44 19 -36 44 8 28 26 27 54 -3z m-419 -66 c0 -65 -3 -82 -16 -87 -21 -8 -32 11 -40 73 -7 59 7 94 36 94 18 0 20 -7 20 -80z m399 -39 c41 -11 75 -22 76 -23 31 -45 35 -59 35 -113 l0 -60 -78 -92 c-66 -79 -84 -95 -132 -112 -90 -34 -104 -44 -111 -79 -4 -18 -9 -35 -11 -38 -3 -2 -36 7 -74 21 -38 14 -93 35 -123 45 -80 29 -81 31 -59 97 l19 57 -35 76 c-39 81 -42 100 -25 132 l11 20 14 -21 c11 -15 26 -21 55 -21 29 0 46 -6 57 -20 11 -13 35 -22 67 -26 64 -8 78 -19 62 -45 -9 -15 -8 -22 5 -35 19 -19 47 -8 67 28 17 33 46 49 100 57 37 5 47 10 49 28 3 18 -7 27 -47 48 -43 21 -51 30 -51 53 0 33 18 54 40 47 8 -2 48 -13 89 -24z m-169 -105 c0 -3 -4 -8 -10 -11 -5 -3 -10 -1 -10 4 0 6 5 11 10 11 6 0 10 -2 10 -4z m-525 -346 c0 -18 -6 -26 -23 -28 -24 -4 -38 18 -28 44 3 9 15 14 28 12 17 -2 23 -10 23 -28z"/>
            <path d="M3290 1611 c-75 -23 -146 -87 -179 -161 -27 -60 -28 -169 -2 -226 78 -172 307 -224 446 -102 l45 40 -52 43 -52 43 -30 -23 c-47 -35 -95 -41 -149 -17 -54 24 -78 57 -84 116 -16 135 139 209 243 115 20 -19 21 -19 78 22 l58 41 -33 34 c-54 56 -122 84 -198 83 -37 0 -77 -4 -91 -8z"/>
            <path d="M5630 1555 l0 -64 68 -3 67 -3 3 -212 2 -213 70 0 70 0 2 213 3 212 68 3 67 3 0 64 0 65 -210 0 -210 0 0 -65z"/>
            <path d="M5258 1452 l-98 -3 0 -194 0 -195 64 0 64 0 3 115 c3 68 9 119 16 126 6 6 26 14 44 18 31 6 34 11 47 64 8 32 13 59 11 61 -10 8 -62 11 -151 8z"/>
            <path d="M3640 1255 l0 -195 65 0 65 0 0 195 0 195 -65 0 -65 0 0 -195z"/>
            <path d="M3830 1180 l0 -270 65 0 65 0 0 76 0 76 39 -7 c49 -8 116 10 159 42 117 89 102 267 -28 333 -31 16 -59 19 -169 19 l-131 1 0 -270z m253 122 c24 -21 22 -77 -3 -102 -23 -23 -42 -25 -73 -9 -29 16 -37 28 -37 64 0 38 9 52 40 63 28 10 47 6 73 -16z"/>
            <path d="M4835 1436 c-37 -17 -90 -72 -104 -108 -15 -40 -16 -108 -2 -150 7 -21 30 -53 52 -72 74 -63 167 -70 247 -19 42 27 90 99 76 112 -5 4 -29 13 -54 20 l-45 13 55 20 c30 12 57 22 58 24 2 1 1 17 -3 34 -9 40 -70 109 -112 127 -41 17 -129 16 -168 -1z m103 -115 c10 -6 2 -13 -27 -25 -23 -9 -46 -16 -52 -16 -16 0 11 30 36 40 26 11 28 11 43 1z m40 -103 c-7 -21 -53 -42 -74 -34 -16 7 -13 11 21 26 49 22 58 24 53 8z"/>
            <path d="M6111 1428 c-79 -39 -124 -141 -101 -229 15 -54 81 -123 131 -137 20 -5 88 -7 152 -4 l117 5 0 106 c0 58 -5 123 -10 143 -33 116 -175 173 -289 116z m142 -126 c24 -21 22 -77 -3 -102 -23 -23 -42 -25 -73 -9 -29 16 -37 28 -37 64 0 38 9 52 40 63 28 10 47 6 73 -16z"/>
            <path d="M1569 1309 c-15 -29 -7 -148 11 -159 8 -5 22 -4 32 1 15 8 18 22 18 79 0 37 -3 75 -6 84 -9 23 -41 20 -55 -5z"/>
            <path d="M1381 1216 c-16 -19 -5 -39 53 -96 38 -36 50 -43 63 -34 30 19 25 33 -28 89 -54 58 -69 64 -88 41z"/>
            <path d="M1726 1178 c-49 -56 -57 -91 -21 -96 25 -3 118 100 113 126 -7 37 -44 25 -92 -30z"/>
            <path d="M1457 770 c-43 -34 -88 -97 -81 -114 12 -31 48 -17 97 38 52 61 56 71 28 85 -14 8 -25 6 -44 -9z"/>
            <path d="M1693 783 c-24 -9 -12 -38 37 -91 52 -56 82 -65 88 -26 2 13 -14 39 -43 72 -45 50 -56 56 -82 45z"/>
            <path d="M1570 704 c-13 -33 -13 -105 0 -139 7 -20 16 -26 33 -23 20 3 22 9 25 81 3 80 -6 107 -34 107 -8 0 -19 -12 -24 -26z"/>
            <path d="M3122 654 c-25 -18 -31 -74 -8 -93 7 -6 36 -18 65 -27 40 -11 52 -20 57 -39 4 -15 1 -32 -6 -40 -14 -17 -82 -20 -111 -5 -15 8 -19 7 -19 -4 0 -19 22 -26 80 -26 57 0 90 26 90 70 0 35 -23 55 -85 72 -39 11 -51 18 -53 36 -2 13 2 30 8 38 14 16 73 19 101 4 15 -8 19 -7 19 4 0 7 -7 17 -16 20 -30 11 -100 6 -122 -10z"/>
            <path d="M3320 661 c0 -6 19 -11 43 -13 l42 -3 3 -112 c2 -91 5 -113 17 -113 12 0 15 21 15 115 l0 115 45 0 c25 0 45 5 45 10 0 6 -42 10 -105 10 -59 0 -105 -4 -105 -9z"/>
            <path d="M3604 613 c-12 -32 -33 -89 -48 -126 -22 -60 -23 -68 -9 -65 10 2 21 18 27 36 9 31 10 32 67 32 57 0 58 0 70 -35 8 -21 20 -35 30 -35 15 0 10 19 -30 123 -57 149 -74 160 -107 70z m82 -100 c-2 -2 -24 -3 -48 -1 l-44 3 24 64 25 64 24 -63 c13 -35 21 -65 19 -67z"/>
            <path d="M3805 603 c40 -61 45 -74 45 -125 0 -45 3 -58 15 -58 12 0 15 13 15 61 0 54 4 66 40 119 44 64 46 70 28 70 -7 0 -26 -20 -41 -45 -16 -25 -33 -47 -38 -50 -4 -3 -23 17 -41 44 -19 29 -41 51 -51 51 -14 0 -8 -13 28 -67z"/>
            <path d="M4140 545 c0 -104 2 -125 15 -125 13 0 15 21 15 125 0 104 -2 125 -15 125 -13 0 -15 -21 -15 -125z"/>
            <path d="M4270 546 c0 -104 3 -126 15 -126 11 0 15 20 17 101 l3 100 53 -100 c45 -86 57 -101 78 -101 l24 0 0 125 c0 103 -3 125 -15 125 -11 0 -15 -21 -17 -107 l-3 -108 -56 105 c-41 78 -61 106 -77 108 -22 3 -22 1 -22 -122z"/>
            <path d="M4675 646 c-46 -46 -27 -87 48 -107 54 -14 67 -25 67 -59 0 -39 -53 -53 -114 -30 -20 7 -26 6 -26 -4 0 -19 22 -26 79 -26 54 0 86 19 95 56 11 41 -15 70 -74 84 -106 25 -81 106 26 85 28 -5 35 -3 32 7 -3 8 -25 14 -56 16 -44 3 -56 -1 -77 -22z"/>
            <path d="M4910 545 c0 -104 2 -125 15 -125 12 0 15 13 15 60 l0 60 65 0 65 0 0 -60 c0 -47 3 -60 15 -60 13 0 15 21 15 125 0 104 -2 125 -15 125 -12 0 -15 -13 -15 -55 l0 -55 -65 0 -65 0 0 55 c0 42 -3 55 -15 55 -13 0 -15 -21 -15 -125z"/>
            <path d="M5251 648 c-5 -13 -25 -65 -45 -117 -40 -104 -42 -111 -22 -111 7 0 17 15 22 33 9 31 12 32 67 35 57 3 58 3 72 -32 9 -20 22 -36 31 -36 9 0 14 4 12 8 -1 4 -23 61 -47 125 -35 92 -48 117 -63 117 -10 0 -22 -10 -27 -22z m48 -68 c12 -30 21 -58 21 -62 0 -5 -21 -8 -46 -8 -33 0 -45 4 -42 13 3 6 13 36 23 65 9 29 18 52 20 50 2 -2 13 -28 24 -58z"/>
            <path d="M5450 546 l0 -126 55 0 c105 0 156 41 157 125 2 87 -31 116 -139 123 l-73 5 0 -127z m125 90 c18 -8 38 -23 44 -34 15 -28 13 -103 -3 -124 -16 -21 -58 -38 -97 -38 l-29 0 0 105 0 105 25 0 c14 0 41 -6 60 -14z"/>
            <path d="M5769 639 c-34 -37 -46 -88 -30 -139 16 -54 52 -80 110 -80 72 1 111 44 111 123 0 86 -36 126 -113 127 -42 0 -53 -5 -78 -31z m122 -2 c44 -33 54 -126 18 -171 -26 -33 -86 -37 -113 -7 -37 41 -37 131 -1 171 20 23 71 26 96 7z"/>
            <path d="M6024 653 c3 -10 17 -66 32 -125 24 -96 29 -108 48 -108 20 0 25 11 46 101 13 55 27 102 30 104 4 3 17 -43 30 -100 21 -95 25 -105 45 -105 20 0 25 11 49 108 15 59 29 115 32 125 3 11 0 17 -10 17 -9 0 -19 -15 -25 -37 -5 -21 -17 -67 -26 -103 -9 -36 -18 -66 -20 -68 -1 -1 -10 28 -19 65 -35 139 -36 143 -55 143 -14 0 -22 -20 -41 -101 -13 -55 -27 -102 -31 -104 -3 -3 -17 43 -30 100 -19 88 -26 105 -42 105 -13 0 -17 -5 -13 -17z"/>
        </g>
    </svg>

</div>

<div class="messages">
    <form method="get">
        <p>Welcome, {{ user.username }}!</p>
        {% for message in messages %}
            <div class="chat">
                <p><a href="/chat/{{ message.chat.pk }}"> {% if message.chat.pk == user.id %} Saved messages {% else %}
                    {{ message.receiver }} {% endif %}</a></p>
                <p class="text">{{ message.message }} {{ message.pub_date }}</p>
            </div>
        {% endfor %}
    </form>
</div>

<div class="send">
    <div class="actions">
        {% csrf_token %}
        <a href="/logout">Выход</a>
        {% if user.is_superuser %}
            <a href="/admin">Админ панель</a>
        {% endif %}
    </div>

    {% if room_name != 0 %}

        <table id="chat">
            {% for message in message_list %}
                <tr>
                    <td>{{ message.author }} {{ message.message }} {{ message.pub_date }}</td>
                </tr>
            {% endfor %}
        </table>
        
        <div class="chat-send">
            <div class="chat-messages"> </div>
            
            <div id="chat-log">
                <input class="send-input" type="text" id="message-input"/>
                <button class="send-btn" onclick="sendMessage()">Отправить</button>
            </div>
        </div>


        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            const roomName = "{{ room_name }}";
            const socket = new WebSocket('ws://' + window.location.host + '/ws/chat/' + roomName + '/');
            socket.onmessage = function (e) {
                const data = JSON.parse(e.data);
                const message = data['message'];
                const sender = data['sender']
                const currentDate = new Date();
                $('#chat-log').append('<div class="full_message">' + sender + ' ' + message + ' ' + currentDate + '</div>');
            };

            function sendMessage() {
                const messageInput = $('#message-input');
                const message = messageInput.val();

                socket.send(JSON.stringify({'sender': '{{ user }}', 'message': message, 'receiver': {{ receiver }}}));
                messageInput.val('');
            }
        </script>
    {% endif %}
</div>

</body>
</html>